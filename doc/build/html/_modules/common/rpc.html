<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>common.rpc &mdash; Lab Instrument Control and Automation Framework 1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Lab Instrument Control and Automation Framework 1.0 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../../index.html">Lab Instrument Control and Automation Framework 1.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for common.rpc</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">select</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">import</span> <span class="nn">jsonrpc</span>

<span class="k">class</span> <span class="nc">RpcServer</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Flexible RPC server that runs in a Python thread. Wraps any Python object</span>
<span class="sd">    and allows remote machines to call functions and receive returned data.</span>
<span class="sd">    </span>
<span class="sd">    :param Logger: Logger instance if you wish to override the internal instance</span>
<span class="sd">    :type Logger: Logging.logger</span>
<span class="sd">    :param target: Target object</span>
<span class="sd">    :type target: object</span>
<span class="sd">    :param port: Port to attach socket to</span>
<span class="sd">    :type port: int </span>
<span class="sd">    </span>
<span class="sd">    .. note::</span>

<span class="sd">        Method calls to functions that begin with an underscore are considered </span>
<span class="sd">        protected and will no be invoked</span>
<span class="sd">    </span>
<span class="sd">    .. note::</span>
<span class="sd">    </span>
<span class="sd">        If an RPC call begins with rpc, the function will only be called if the</span>
<span class="sd">        target object extends RpcBase. These functions are considered reserved.</span>
<span class="sd">        If a target object does not extend RpcBase, the RpcServer will not </span>
<span class="sd">        allow use of these reserved functions, even if they are defined in the</span>
<span class="sd">        target class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c"># Exclusive access times out after 60 seconds</span>
    <span class="n">EXCLUSIVE_TIMEOUT</span> <span class="o">=</span> <span class="mf">60.0</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">alive</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="s">&#39;target&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;target&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;RPC-Server-&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;RPC Server must be provided a target object&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="s">&#39;port&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;port&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;port&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Auto-assign the port to a free port</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c"># RPC Client Synchronization lock</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>

        <span class="c"># Socket management</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connections</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exclusiveTime</span> <span class="o">=</span> <span class="bp">None</span>
        
    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start the RPC Server Thread. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Start socket</span>
        <span class="c"># TODO: Should this be off-loaded to the RPC Protocol API?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">socket</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">getsockname</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;logger&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;[</span><span class="si">%s</span><span class="s">] listening on port </span><span class="si">%i</span><span class="s">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;[</span><span class="si">%s</span><span class="s">] Hostname: </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">())</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">alive</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">alive</span><span class="o">.</span><span class="n">isSet</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c"># Spawn a new thread to service the connection</span>
                <span class="n">connection</span><span class="p">,</span> <span class="n">address</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
                <span class="c"># Spawn a new thread to service the connection</span>
                <span class="n">connThread</span> <span class="o">=</span> <span class="n">RpcConnection</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="n">address</span><span class="p">,</span> <span class="n">socket</span><span class="o">=</span><span class="n">connection</span><span class="p">)</span>
                <span class="c"># Give the name a meaningful name</span>
                <span class="n">connThread</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;RPC-Conn-&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">+</span> <span class="n">connThread</span><span class="o">.</span><span class="n">name</span>
                
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;logger&#39;</span><span class="p">):</span>
                    <span class="n">connThread</span><span class="o">.</span><span class="n">attachLogger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
                <span class="n">connThread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">connThread</span><span class="p">)</span>
                
            <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
                <span class="c"># The socket probably closed, if so alive will be cleared</span>
                <span class="k">continue</span>
            
            <span class="k">except</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;logger&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s">&#39;There was an exception raised while handling a connection request&#39;</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span>
                
        <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;logger&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;[</span><span class="si">%s</span><span class="s">] RPC Server thread stopped&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">getPort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the port that is bound by the RpcServer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">getsockname</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
        
    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Close all connections and stop the RpcServer thread</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Close all connections</span>
        <span class="k">for</span> <span class="n">socket</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">:</span>
            <span class="n">socket</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alive</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">attachLogger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loggerObj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attach a logging.Logger instance for the RpcServer to use.</span>
<span class="sd">        </span>
<span class="sd">        :param loggerObj: Logger instance if you wish to override the internal instance</span>
<span class="sd">        :type loggerObj: Logging.logger</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">loggerObj</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">loggerObj</span>
      
<div class="viewcode-block" id="RpcBase"><a class="viewcode-back" href="../../rpc.html#common.rpc.RpcBase">[docs]</a><span class="k">class</span> <span class="nc">RpcBase</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    RpcBase provides helper functions to facilitate RPC operation. A server will </span>
<span class="sd">    check if the target class inherits this base class to ensure that certain </span>
<span class="sd">    functions will be available</span>
<span class="sd">    </span>
<span class="sd">    Each instantiation of an RpcBase object will generate a UUID to identify it</span>
<span class="sd">    to RPC Clients</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rpc_thread</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">exclusive</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">exclusiveTime</span> <span class="o">=</span> <span class="bp">None</span>
    
    <span class="n">__identity</span> <span class="o">=</span> <span class="s">&#39;JSON-RPC/2.0&#39;</span>
        
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exclusiveTime</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uuid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid1</span><span class="p">())</span>
        
    <span class="k">def</span> <span class="nf">_setHELOResponse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__identity</span> <span class="o">=</span> <span class="n">response</span>
        
    <span class="k">def</span> <span class="nf">_getHELOResponse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__identity</span>
        
<div class="viewcode-block" id="RpcBase.rpc_test"><a class="viewcode-back" href="../../rpc.html#common.rpc.RpcBase.rpc_test">[docs]</a>    <span class="k">def</span> <span class="nf">rpc_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests if a port on the RpcServer host is being used.</span>
<span class="sd">        </span>
<span class="sd">        :param port: Port to test</span>
<span class="sd">        :type port: int</span>
<span class="sd">        :returns: bool - True if the port is being used, False if it is free</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">port</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ts</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
                <span class="n">ts</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
            
            <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">==</span> <span class="mi">10061</span><span class="p">:</span> <span class="c"># Refused connection</span>
                    <span class="k">return</span> <span class="bp">False</span>
                <span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">==</span> <span class="mi">10054</span><span class="p">:</span> <span class="c"># Connection reset</span>
                    <span class="k">return</span> <span class="bp">False</span>
                <span class="k">elif</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">==</span> <span class="mi">10060</span><span class="p">:</span> <span class="c"># Time out</span>
                    <span class="k">return</span> <span class="bp">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># Something else is wrong, assume port cannot be used</span>
                    <span class="k">return</span> <span class="bp">True</span>
            
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">ts</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                
            <span class="c"># If no exception was thrown, connection was successful and port is in use</span>
            <span class="k">return</span> <span class="bp">True</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># No port was provided to check</span>
            <span class="k">return</span> <span class="bp">False</span>
    </div>
<div class="viewcode-block" id="RpcBase.rpc_start"><a class="viewcode-back" href="../../rpc.html#common.rpc.RpcBase.rpc_start">[docs]</a>    <span class="k">def</span> <span class="nf">rpc_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Spawns an RpcServer thread to handle connections on the given port.</span>
<span class="sd">        </span>
<span class="sd">        :param port: Port to bind</span>
<span class="sd">        :type port: int</span>
<span class="sd">        :returns: bool - True if the RpcServer starts successfully, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rpc_thread</span><span class="p">,</span> <span class="n">RpcServer</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rpc_thread</span> <span class="o">=</span> <span class="n">RpcServer</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;logger&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rpc_thread</span><span class="o">.</span><span class="n">attachLogger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">rpc_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rpc_startTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        
            <span class="c"># Wait for thread to come alive</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rpc_thread</span><span class="o">.</span><span class="n">alive</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_thread</span><span class="o">.</span><span class="n">alive</span><span class="o">.</span><span class="n">is_set</span><span class="p">()</span>
        </div>
<div class="viewcode-block" id="RpcBase.rpc_stop"><a class="viewcode-back" href="../../rpc.html#common.rpc.RpcBase.rpc_stop">[docs]</a>    <span class="k">def</span> <span class="nf">rpc_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stops a running RpcServer thread.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rpc_thread</span><span class="p">,</span> <span class="n">RpcServer</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rpc_thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rpc_thread</span> <span class="o">=</span> <span class="bp">None</span>
            </div>
<div class="viewcode-block" id="RpcBase.rpc_restart"><a class="viewcode-back" href="../../rpc.html#common.rpc.RpcBase.rpc_restart">[docs]</a>    <span class="k">def</span> <span class="nf">rpc_restart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stops and restarts a running RpcServer thread</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rpc_stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rpc_start</span><span class="p">()</span>
        </div>
<div class="viewcode-block" id="RpcBase.rpc_uptime"><a class="viewcode-back" href="../../rpc.html#common.rpc.RpcBase.rpc_uptime">[docs]</a>    <span class="k">def</span> <span class="nf">rpc_uptime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the uptime of the RpcServer</span>
<span class="sd">        </span>
<span class="sd">        :returns: int - uptime in seconds</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;rpc_startTime&#39;</span><span class="p">):</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_startTime</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">delta</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        </div>
<div class="viewcode-block" id="RpcBase.rpc_getPort"><a class="viewcode-back" href="../../rpc.html#common.rpc.RpcBase.rpc_getPort">[docs]</a>    <span class="k">def</span> <span class="nf">rpc_getPort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the bound port of a running RpcServer thread.</span>
<span class="sd">        </span>
<span class="sd">        :returns: int - Port</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rpc_thread</span><span class="p">,</span> <span class="n">RpcServer</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_thread</span><span class="o">.</span><span class="n">alive</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_thread</span><span class="o">.</span><span class="n">getPort</span><span class="p">()</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        </div>
<div class="viewcode-block" id="RpcBase.rpc_isRunning"><a class="viewcode-back" href="../../rpc.html#common.rpc.RpcBase.rpc_isRunning">[docs]</a>    <span class="k">def</span> <span class="nf">rpc_isRunning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if there is an RpcServer thread running</span>
<span class="sd">        </span>
<span class="sd">        :returns: bool - True if running, False if not running</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rpc_thread</span><span class="p">,</span> <span class="n">RpcServer</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_thread</span><span class="o">.</span><span class="n">alive</span><span class="o">.</span><span class="n">is_set</span><span class="p">()</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    </div>
    <span class="k">def</span> <span class="nf">rpc_getConnections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c"># TODO</span>
        <span class="k">pass</span>
    
<div class="viewcode-block" id="RpcBase.rpc_getMethods"><a class="viewcode-back" href="../../rpc.html#common.rpc.RpcBase.rpc_getMethods">[docs]</a>    <span class="k">def</span> <span class="nf">rpc_getMethods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a list of methods in the target object. Used by RpcClient to populate</span>
<span class="sd">        remote objects.</span>
<span class="sd">        </span>
<span class="sd">        :returns: list of strings</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">inspect</span>
        
        <span class="n">validMethods</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c"># Create a list of methods that can be called</span>
        <span class="n">target_members</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">target_members</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">ismethod</span><span class="p">(</span><span class="n">member</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="n">member</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;_&#39;</span><span class="p">:</span>
                <span class="n">validMethods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">member</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                
        <span class="k">return</span> <span class="n">validMethods</span>
    </div>
<div class="viewcode-block" id="RpcBase.rpc_getUUID"><a class="viewcode-back" href="../../rpc.html#common.rpc.RpcBase.rpc_getUUID">[docs]</a>    <span class="k">def</span> <span class="nf">rpc_getUUID</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the RpcServer UUID</span>
<span class="sd">        </span>
<span class="sd">        :returns: str - RpcServer UUID</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uuid</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="RpcBase.rpc_requestExclusiveAccess"><a class="viewcode-back" href="../../rpc.html#common.rpc.RpcBase.rpc_requestExclusiveAccess">[docs]</a>    <span class="k">def</span> <span class="nf">rpc_requestExclusiveAccess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Request exclusive access to the target object from the RPC interface. </span>
<span class="sd">        This acts as a lock on the target object, and no other connections can</span>
<span class="sd">        call functions. </span>
<span class="sd">        </span>
<span class="sd">        .. note::</span>
<span class="sd">        </span>
<span class="sd">            Exclusive Access locks expire after 60 seconds, and must be renewed</span>
<span class="sd">            by another call to :func:`RpcBase.rpc_requestExclusiveAccess`</span>
<span class="sd">            </span>
<span class="sd">        :returns: bool - True if exclusive lock granted, False if denied</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_hasAccess</span><span class="p">(</span><span class="n">connection</span><span class="p">):</span>
            <span class="c"># No other connection has exclusive access, or previous owner did not renew exclusive lock</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span> <span class="o">=</span> <span class="n">connection</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exclusiveTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;[</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">] Requested exclusive access&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">connection</span><span class="o">.</span><span class="n">address</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="bp">True</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
            </div>
<div class="viewcode-block" id="RpcBase.rpc_releaseExclusiveAccess"><a class="viewcode-back" href="../../rpc.html#common.rpc.RpcBase.rpc_releaseExclusiveAccess">[docs]</a>    <span class="k">def</span> <span class="nf">rpc_releaseExclusiveAccess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Release exclusive access. If a connection does not have exclusive access,</span>
<span class="sd">        this function does nothing.</span>
<span class="sd">        </span>
<span class="sd">        .. note::</span>
<span class="sd">        </span>
<span class="sd">            This function does not have to be called explicitly, the lock</span>
<span class="sd">            will expire automatically after 60 seconds.</span>
<span class="sd">            </span>
<span class="sd">        :returns: bool - True if lock released, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">,</span> <span class="n">RpcConnection</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span> <span class="o">==</span> <span class="n">connection</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span> <span class="o">=</span> <span class="bp">None</span>
              
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;[</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">] Released exclusive access&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">connection</span><span class="o">.</span><span class="n">address</span><span class="p">)</span>
              
            <span class="k">return</span> <span class="bp">True</span>
          
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
              </div>
<div class="viewcode-block" id="RpcBase.rpc_hasExclusiveAccess"><a class="viewcode-back" href="../../rpc.html#common.rpc.RpcBase.rpc_hasExclusiveAccess">[docs]</a>    <span class="k">def</span> <span class="nf">rpc_hasExclusiveAccess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if the requesting connection has exclusive access.</span>
<span class="sd">        </span>
<span class="sd">        :returns: bool - True if requesting connection has exclusive access, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">,</span> <span class="n">RpcConnection</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span> <span class="o">==</span> <span class="n">connection</span> <span class="ow">and</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">EXCLUSIVE_TIMEOUT</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusiveTime</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">True</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        </div>
    <span class="k">def</span> <span class="nf">rpc_whoHasExclusiveAccess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">):</span>
        <span class="c"># TODO</span>
        <span class="k">pass</span>
    
    <span class="k">def</span> <span class="nf">rpc_hasAccess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span><span class="p">,</span> <span class="n">RpcConnection</span><span class="p">)</span> <span class="ow">and</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">EXCLUSIVE_TIMEOUT</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusiveTime</span><span class="p">)):</span>
            <span class="k">return</span> <span class="bp">True</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        
<div class="viewcode-block" id="RpcBase.rpc_getHostname"><a class="viewcode-back" href="../../rpc.html#common.rpc.RpcBase.rpc_getHostname">[docs]</a>    <span class="k">def</span> <span class="nf">rpc_getHostname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the hostname of the RpcServer host.</span>
<span class="sd">        </span>
<span class="sd">        :returns: str - hostname</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hostname</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">hostname</span>
      </div>
<div class="viewcode-block" id="RpcBase.rpc_getObjectName"><a class="viewcode-back" href="../../rpc.html#common.rpc.RpcBase.rpc_getObjectName">[docs]</a>    <span class="k">def</span> <span class="nf">rpc_getObjectName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the name of the object that may be extending RpcBase.</span>
<span class="sd">        </span>
<span class="sd">        :returns: str - Object name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
    </div></div>
<span class="k">class</span> <span class="nc">RpcConnection</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Receives and processes RPC requests from remote connections (or local ones)</span>
<span class="sd">    </span>
<span class="sd">    Before any requests can be processed, the thread must acquire a lock to synchronize access</span>
<span class="sd">    to the shared resource (model object)</span>
<span class="sd">    </span>
<span class="sd">    Remote users can request exclusive access, but must renew the lock every 60 seconds or other users will be</span>
<span class="sd">    allowed to request access</span>
<span class="sd">    </span>
<span class="sd">    Any method that begins with an underscore is considered protected and will be invalidated by the RPC server</span>

<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;parent&#39;</span><span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;address&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;address&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">socket</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;socket&#39;</span><span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">lock</span>
        <span class="c">#self.name = self.parent.name</span>
        
        <span class="c"># Hardcode JSON RPC for now</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rpc_decode</span> <span class="o">=</span> <span class="n">jsonrpc</span><span class="o">.</span><span class="n">decode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rpc_encode</span> <span class="o">=</span> <span class="n">jsonrpc</span><span class="o">.</span><span class="n">encode</span>
        
        <span class="c"># Socket management</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alive</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alive</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;logger&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;[</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">] Connection established&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">)</span>
        
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">alive</span><span class="o">.</span><span class="n">isSet</span><span class="p">():</span>
            <span class="c"># Check for incoming data</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;HELO&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">_getHELOResponse</span><span class="p">())</span>
                    
                <span class="k">elif</span> <span class="n">data</span><span class="p">:</span>
                    <span class="c"># Process the incoming data as a JSON RPC packet</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">request</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_decode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                    <span class="k">except</span> <span class="n">Rpc_Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">request</span> <span class="o">=</span> <span class="n">e</span>
                        
                    <span class="c"># self.logger.debug(&#39;RX: %s&#39;, data)</span>
                        
                    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">target</span>
                    
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">request</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">request</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c"># Iterate through each request, verify access criteria</span>
                        <span class="k">for</span> <span class="n">req</span> <span class="ow">in</span> <span class="n">request</span><span class="p">:</span>
                            
                             <span class="c"># Disallow access to methods that start with an underscore</span>
                            <span class="k">if</span> <span class="n">req</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;&#39;</span> <span class="ow">or</span> <span class="n">req</span><span class="o">.</span><span class="n">method</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;_&#39;</span><span class="p">:</span>
                                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Rpc_Response</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">req</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">Rpc_InvalidRequest</span><span class="p">()))</span>
                                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;logger&#39;</span><span class="p">):</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;[</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%i</span><span class="s">] RPC request for protected method: </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">req</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">req</span><span class="o">.</span><span class="n">method</span><span class="p">)</span>
                             
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">allow</span> <span class="o">=</span> <span class="bp">True</span>
                                
                                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">RpcBase</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">target</span><span class="o">.</span><span class="n">rpc_hasAccess</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                                    <span class="c"># Send an error if somebody has exclusive access</span>
                                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Rpc_Response</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">req</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;code&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">32001</span><span class="p">,</span> <span class="s">&#39;message&#39;</span><span class="p">:</span> <span class="s">&#39;Another connection has exclusive access.&#39;</span><span class="p">}))</span>
                                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;logger&#39;</span><span class="p">):</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;[</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%i</span><span class="s">] RPC request denied - another user has exclusive access: </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">req</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">req</span><span class="o">.</span><span class="n">method</span><span class="p">)</span>
                                    
                                    <span class="n">allow</span> <span class="o">=</span> <span class="bp">False</span>
                                    
                                <span class="k">if</span> <span class="n">allow</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;logger&#39;</span><span class="p">):</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;[</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%i</span><span class="s">] RPC method call: </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">req</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">req</span><span class="o">.</span><span class="n">method</span><span class="p">)</span>
                                        
                                    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>      
                                        <span class="k">try</span><span class="p">:</span>
                                            <span class="k">if</span> <span class="n">req</span><span class="o">.</span><span class="n">method</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;rpc&#39;</span><span class="p">:</span>
                                                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
                                            <span class="k">else</span><span class="p">:</span>
                                                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">target</span><span class="p">))</span>
                                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                                            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;logger&#39;</span><span class="p">):</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s">&#39;[</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%i</span><span class="s">] RPC Unhandled Exception: </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">req</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">req</span><span class="o">.</span><span class="n">method</span><span class="p">)</span>
                                            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Rpc_Response</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">req</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">Rpc_InternalError</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))))</span>
                                
                    <span class="k">elif</span> <span class="n">request</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">Rpc_Error</span><span class="p">):</span>
                        <span class="c"># An invalid request was parsed, error will be passed through to encode()</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="n">request</span>
                    
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c"># Something really terrible must have happened</span>
                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;logger&#39;</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;RPC Library Error&quot;</span><span class="p">)</span>
                    
                    <span class="c"># Encode the outputs of the RPC requests</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rpc_encode</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
                    
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># Connection was closed by client</span>
                    <span class="k">break</span>
                
            <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c"># Socket closed poorly from client</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;logger&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;[</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">] Socket closed with error: </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span><span class="p">)</span>
                <span class="k">break</span>

            <span class="k">except</span><span class="p">:</span>
                <span class="c"># Log an exception, close the connection</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;logger&#39;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s">&#39;[</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">] Unhandled Exception&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">)</span>
                <span class="k">break</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alive</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;logger&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;[</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">] Disconnected&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alive</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;logger&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;[</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">] Connection was asked to close internally&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">attachLogger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loggerObj</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">loggerObj</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">loggerObj</span>
    
<div class="viewcode-block" id="RpcClient"><a class="viewcode-back" href="../../rpc.html#common.rpc.RpcClient">[docs]</a><span class="k">class</span> <span class="nc">RpcClient</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Flexible RPC client that connects to an RpcServer instance either on a local</span>
<span class="sd">    host or remote host. Abstracts a remote object using the magic of Python.</span>
<span class="sd">    By utilizing functions from the remote RpcServer and object that extends</span>
<span class="sd">    RpcBase, RpcClient can dynamically create method aliases. In this way, a</span>
<span class="sd">    RpcClient object can &quot;become&quot; an instance of an object on a remote host.</span>
<span class="sd">    </span>
<span class="sd">    .. note::</span>
<span class="sd">        If the remote RPC server does not extend RpcBase, then it will be </span>
<span class="sd">        impossible to create aliases for remote functions. An alias method can </span>
<span class="sd">        be created manually using RpcClient._methodAlias()</span>
<span class="sd">    </span>
<span class="sd">    To manually call a remote method, use the function RpcClient._rpcCall</span>
<span class="sd">    </span>
<span class="sd">    :param address: IP Address of remote RpcServer (Defaults to &#39;localhost&#39;)</span>
<span class="sd">    :type address: str - IPv4</span>
<span class="sd">    :param port: Port of remote RpcServer</span>
<span class="sd">    :type port: int</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">RPC_TIMEOUT</span> <span class="o">=</span> <span class="mf">10.0</span>
    <span class="n">RPC_MAX_PACKET_SIZE</span> <span class="o">=</span> <span class="mi">4096</span> <span class="c"># 4K</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="s">&#39;port&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;port&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="s">&#39;address&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">socket</span><span class="o">.</span><span class="n">inet_aton</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;address&#39;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;address&#39;</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyaddr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
                    <span class="c"># Assume a hostname was given</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;address&#39;</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hostname</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Loopback mode</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="s">&#39;127.0.0.1&#39;</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">()</span>
                 
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&#39;RpcClient must be provided a port&#39;</span><span class="p">)</span>
        
        <span class="c"># Protocol aliases</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__rpcDecode__</span> <span class="o">=</span> <span class="n">jsonrpc</span><span class="o">.</span><span class="n">decode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__rpcEncode__</span> <span class="o">=</span> <span class="n">jsonrpc</span><span class="o">.</span><span class="n">encode</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">nextID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rpcNextID</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RPC_TIMEOUT</span>
        
        <span class="c"># Try to open a socket</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">socket</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">setblocking</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">ready</span> <span class="o">=</span> <span class="bp">True</span>
            
        <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">ready</span> <span class="o">=</span> <span class="bp">False</span>
            
        <span class="c"># Request a list of methods, an error here is acceptable if the remote</span>
        <span class="c"># host does not inherit RpcBase</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ready</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_setTimeout</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">methods</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rpcCall</span><span class="p">(</span><span class="s">&#39;rpc_getMethods&#39;</span><span class="p">)</span>
                
                <span class="k">for</span> <span class="n">proc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">methods</span><span class="p">:</span>
                    <span class="n">dynFunc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_methodAlias</span><span class="p">(</span><span class="n">proc</span><span class="p">)</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proc</span><span class="p">,</span> <span class="n">dynFunc</span><span class="p">)</span>
                    
                <span class="c"># Update the hostname</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rpcCall</span><span class="p">(</span><span class="s">&#39;rpc_getHostname&#39;</span><span class="p">)</span>
                    
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
            
    <span class="k">def</span> <span class="nf">_setTimeout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_to</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">new_to</span>
            
    <span class="k">def</span> <span class="nf">_getHostname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hostname</span>
    
    <span class="k">def</span> <span class="nf">_getAddress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">address</span>
    
    <span class="k">def</span> <span class="nf">_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ready</span>
    
    <span class="k">def</span> <span class="nf">_close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
<div class="viewcode-block" id="RpcClient._rpcCall"><a class="viewcode-back" href="../../rpc.html#common.rpc.RpcClient._rpcCall">[docs]</a>    <span class="k">def</span> <span class="nf">_rpcCall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">remote_method</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls a function on the remote host with both positional and keyword</span>
<span class="sd">        arguments</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            - Whatever the remote function returns</span>
<span class="sd">            </span>
<span class="sd">        Exceptions:</span>
<span class="sd">            - AttributeError when method not found (same as if a local call)</span>
<span class="sd">            - RuntimeError when the remote host sent back a server error</span>
<span class="sd">            - Rpc_Timeout when the request times out</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nextID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nextID</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="n">request</span> <span class="o">=</span> <span class="p">[</span><span class="n">Rpc_Request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">remote_method</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">nextID</span><span class="p">)]</span>
        
        <span class="n">out_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rpcEncode__</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">out_str</span><span class="p">)</span>
        
        <span class="c"># Wait for return data or timeout</span>
        <span class="n">ready</span> <span class="o">=</span> <span class="n">select</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ready</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RPC_MAX_PACKET_SIZE</span><span class="p">)</span>
            
            <span class="n">_</span><span class="p">,</span> <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__rpcDecode__</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Rpc_Response</span><span class="p">):</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">isError</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">error</span><span class="p">[</span><span class="s">&#39;code&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">32601</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;message&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
                    
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c"># An error occurred!</span>
                        <span class="k">raise</span> <span class="n">Rpc_ServerException</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;message&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
            
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">result</span>
                
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Rpc_Timeout</span><span class="p">()</span>
        </div>
    <span class="k">def</span> <span class="nf">__rpcNextID</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">nextID</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">yield</span> <span class="nb">int</span><span class="p">(</span><span class="n">nextID</span><span class="p">)</span>
            <span class="n">nextID</span> <span class="o">+=</span> <span class="mi">1</span>

<div class="viewcode-block" id="RpcClient._methodAlias"><a class="viewcode-back" href="../../rpc.html#common.rpc.RpcClient._methodAlias">[docs]</a>    <span class="k">def</span> <span class="nf">_methodAlias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">methodName</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Used to fill the current object with methods that link to remote functions</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rpcCall</span><span class="p">(</span><span class="n">methodName</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    </div>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;&lt;RPC Instance of </span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
                
    </div>
<span class="k">class</span> <span class="nc">Rpc_Request</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;method&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;params&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;kwargs&#39;</span><span class="p">,</span> <span class="p">{})</span>
        
    <span class="k">def</span> <span class="nf">export</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Slight modification of the JSON RPC 2.0 specification to allow </span>
        <span class="c"># both positional and named parameters</span>
        <span class="c"># Adds kwargs variable to object only when both are present</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s">&#39;method&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="p">}</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">out</span><span class="p">[</span><span class="s">&#39;params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">out</span><span class="p">[</span><span class="s">&#39;kwargs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span>
            
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">out</span><span class="p">[</span><span class="s">&#39;params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span>
            
        <span class="k">return</span> <span class="n">out</span>
        
    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="o">*</span><span class="n">pos_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw_args</span><span class="p">):</span>
        <span class="c"># Parse method        </span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Rpc_Response</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">Rpc_MethodNotFound</span><span class="p">())</span>
            
        <span class="c"># Parse params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params_pos</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pos_args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params_named</span> <span class="o">=</span> <span class="n">kw_args</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="c"># Only named parameters</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params_named</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
            
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="c"># Only positional parameters</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params_pos</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span>
            
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c"># Positional and named parameters</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">params_named</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
                
            <span class="c">#self.params_named = self.params.get(&quot;__args&quot;, [])</span>
            <span class="c">#if self.params_pos:</span>
                <span class="c">#del self.params[&quot;__args&quot;]</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Rpc_Response</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">Rpc_InvalidParams</span><span class="p">())</span>
            
        <span class="c"># Invoke method</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">params_pos</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">params_named</span><span class="p">)</span>
            <span class="c"># Build the response with the results</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c"># Only send a result of a notification if an error occurred</span>
                <span class="k">return</span> <span class="n">Rpc_Response</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">ret</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
        
        <span class="k">except</span> <span class="ne">NotImplementedError</span><span class="p">:</span>
            <span class="c"># Whoops, somebody didn&#39;t follow the API</span>
            <span class="k">return</span> <span class="n">Rpc_Response</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">Rpc_MethodNotFound</span><span class="p">())</span>
            
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        
<span class="k">class</span> <span class="nc">Rpc_Response</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;result&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;error&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">export</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ret</span><span class="p">[</span><span class="s">&#39;error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ret</span><span class="p">[</span><span class="s">&#39;result&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span><span class="p">[</span><span class="s">&#39;result&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
            
        <span class="k">return</span> <span class="n">ret</span>
    
    <span class="k">def</span> <span class="nf">isError</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

<span class="c"># Error Exceptions</span>
<span class="k">class</span> <span class="nc">Rpc_Error</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
    <span class="n">code</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">message</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="ne">RuntimeError</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

<span class="k">class</span> <span class="nc">Rpc_ParseError</span><span class="p">(</span><span class="n">Rpc_Error</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Rpc_InvalidRequest</span><span class="p">(</span><span class="n">Rpc_Error</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Rpc_MethodNotFound</span><span class="p">(</span><span class="n">Rpc_Error</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Rpc_InvalidParams</span><span class="p">(</span><span class="n">Rpc_Error</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Rpc_InternalError</span><span class="p">(</span><span class="n">Rpc_Error</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Rpc_Timeout</span><span class="p">(</span><span class="n">Rpc_Error</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Rpc_ServerException</span><span class="p">(</span><span class="n">Rpc_Error</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../../index.html">Lab Instrument Control and Automation Framework 1.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, KKENNEDY.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>